pragma solidity 0.8.20;

import "forge-std/Test.sol";
import "../src/Types.sol";
import "../src/Troubleshoot.sol";

contract TroubleshootTest is Test {
    Troubleshoot shoot;

    function setUp() public {
        shoot = new Troubleshoot();
    }

    function stringToBytes32(string memory source) public returns (bytes32 result) {
        assembly {
            result := mload(add(source, 32))
        }
    }

    function testAAA() public {
        // success: proveWithdrawal Transaction hash (on L1): https://testnet.bscscan.com/tx/0xb48de1c4cac1ba8452741bdf4aea1d666a1e49154692180c869a30c3a3ad6f02
        bytes[] memory proofs = new bytes[](6);
        proofs[0] = bytes(hex"f90211a0d08ba845c92dfa83fa3a5afe439f0ab7c5be7c1310bace2eccb38d91741d1b81a097be0296d6439f691353fc5809e36a21c645039f0979f111cda95dd68c7b86caa09934ea9554ffeaffc8d65154ba7899b8357146b21091e00ff1ba0c7fda9d9ea9a046b3fadf052d315ec65c429cdf2c85945bbec6a3cc53c1dda8b1dfc8ddcb030ca0cd0b60cefcb8e0089cac81c6d9a9931ae99becfcc8726b008f2186471ad13824a017957172b926c0c7ad8e2930f12e2637a7bb6210d2aaf1be14f1dea7cbaf2998a087e828b7e076a2344765ff67fe65760a6ad7922853d7676ea4dc0084646d5efba099e338f7e3787eb3563389755bd2aa1f8aa13f5be949a93cf55297b8f334c37ba0a431ffa05d588b6ee7b1d02fa2fa8626f18df9adff5a9eba148f0a042623560ca0d9a41b1de6c25135e4bc3ae668ff197eeff054d469e51a36e5437fc8ccd1bedda0f881f9ff620333a32179d640cff75c9cece8d9b2f2cd5e63f26bfbbf648a6805a072d44578b9769fec57e80e44e055dc454f350b725ae80651dd9e440d4bff9ddfa0f99c5c7c6dd44ac2bdce98d3f0224c2d82c631a50a6f15f54e2d70463aea30afa07a09f37c4ecfd2488c08a288fbf7991e413df170f892e8e096b61116cb931ae8a03050ff9b013e930a0bff2b6a0b9517d8fbd6a0d55b9bf7b4aa38eddb3b1174e3a0e4f6e121ecfe32d2dc7342e9b12cb1eb71cdf8a0afa24c3f8556ce3f00bf3cfa80");
        proofs[1] = bytes(hex"f90211a06628e0acc653b884060372d517dd72feb8bbf7d80cf27964113b57e03a2881dca07b163a974d4729c8cd782c274f90d4ca64e1b0803cb147206c85c05053d7bad9a0a1bfb80420eeedacec33a2694194768767bd546632e91e8549da57be824acb8ea0aedec9b1853a58c7864002e19f1efd613908710d25c8248dbaf0dc35e4c3b046a0c3b42eb1cdd3fd103639b602c65880dd235c99c2d5f659d17592394749d6a7fda08a5fe5ed102881059ecf7e990154e24246c1c2a7738d62d195e90679c5ebdc1ea0a507d1616ede840114de7c9cbdb951dcb3d87834ac4bd9f445690fa4d4c913f2a098c5c0b191d5196a1d364b5ed58c4dc6576846630455261510d1ebb4168347e7a055e41d0bceca735bd5fd40ab1e6d14a9f094d3c7f4e692c803c58db429a85626a0b2edb25108a7f9679675151dc3a4a43da9bd83356b47add24cce4204b6a3c389a01ce436423450a7c05f1686914dfe599f3da2ead4a7c37de1c265be0627c34611a02a5cac3aab3d58f261d9f2c3e56c20fb29b8b481cfa0c401ad8daab2b082aa7aa0b32b3ad7e2bb608d130ba6ec32926e67b23f6c59100425f8eb40387b96e2b885a029c4074635d55aa2e900a30f1e46d8ef40f2920e88c289c5085436d26e66076aa031019c509ef4c04403e228f24b9b384b14f1cc4061e5f67d8ff00a9325353552a0e806f4e85c588a5091a8383f2a335f5d4f092fe98731279a2e58cf7ce614415080");
        proofs[2] = bytes(hex"f90211a08d59ccbaa4bceeaae3e2dc2aed8a7d7740477bd36c78858b75edd1553d44c391a082b4aaabfdaea15c1ee247a50736ba78f1ef6ab81501dada78ae44d4fa6527e6a0844712a9368ac8e68a888efa31040be6ca32f57aa88f6539a7e15967e97c4de2a00f65fc15910b163320479302a8a0373a7a9e3774330ccfad136a8cf2c3916bbaa0f34e8aa26e52af51686885320ca2903c9722c76aca513f5165424eac6f2435bba0cb779179f48c6d9a135032f2679347e58a50a64a0aef617fe7f8e312d8829bf2a0052da0bcacdd74a26f459d3d04df463d0b4268425b4bd374c14c2a07246a62f1a09ed89fe677ccd96f2e63f4cdd125ba34fdb5e49b5ed0ed71d6aed22932e25bcca0df5ae5ed98788edb0ec8f66e0457e4ef567d9f8ed619ddb5adf3d45d1bf1b279a006f75f6e6755283b5c73b7bf37a8bad92a74de4621c3ea9edba86f0183735853a05befe9e4d7a50ca163a49bc212af4542c5ec75f5efa0b53e7b828ad2fd119383a0b6040336231463f0d60e9947feb8978f8be8ae5448e8107b38784b005fb98269a079bb7193bce16ff90c5760c5b82699283244012c7e934e7c6cf37950b239b559a0807b6dee7519d1484f9fe66db7e63703b0b361981d8115659b44616beba81fffa093144b87da51c537eee97f745c4670bc841b7bbf324b16acbabb8182b0ff9332a03c06bd9cb5fe52886d157d57559d41c217d9becb4fdfa6eb03bf738e5b38110480");
        proofs[3] = bytes(hex"f901f1a0fc44437c043272c910db3cc9e0ce8cb7638940d4103fde7465493980f0e9491ea0dcf8252d24f8ce95a15ef494ac4672e00fff99d4201282d4491519163683157da0d08b30182d961d8594771844f575c9f123aea1d4c8cbcc9d495d4c0107c861ee80a0ca18551cb66b73914d88627eca9e1b7a9a84a57e6c3a3aeef859592caa252a45a03723cb439c2f2f17fdceac3163975c79917d11447dd019c914bc79997960509fa0eec3ab3cc837b8d4b1129bd84ee62064f4c2dbcf2a6bb8c6e66f8227192142d2a028cde5a8fd4cc0a97997ce9c4c4c97d5ed69aa511f8e4fe4088cbf155aca17a4a017265eb322471de4afcc06aac23a933968127ca24f42688c93378812fb8701cda06b8ddd18b19fc98aee0bb987c4405f6527f4097a907ef5060b03963008ae9ecca02149bf843a61db5ce34debccaddfb0c95ed8cfe0bf33b23e366cb2352d755036a0a702feedf4f756bf8e28b321c433cfb99dec040bc5bb40bfefd23fed34716d77a0d791991822f82050ee9851a26bd5f042cb6462f89ee28bb49f8507c86cd999c5a0d7f6d0dac764c88a5424b2c7ec457c2b4573aa15ca249e7e9f2b6d15729f8b28a098f6ac1493aad595e80f338eaa1e3ab7a53f2c3a7ce9f8d22073a60e460e0e80a0b33e6a2f754d8234b1cdea53bbeb9c56b8264d923e84f7f37b5729ba76f6ad2280");
        proofs[4] = bytes(hex"f891808080a0e406004bb104708e8afe602efbcfa822889de17f44cb92d0e317f5bef9391aa580808080808080a0931beaf52f6aa7de147f36482b5ddfbdf711e8d1f61b1fde96bb72481d03b86180a059130b40386985969989cdcb43e66b49dc69da82d860643ac66e497c1e06530b80a0c0d459704ac5816511c065aed734cf84a14acfa82a8db0b73d0e322ceaae2b0380");
        proofs[5] = bytes(hex"e09e370f96620d27102d4799d259fe08f690c0a21b80d0a1a903db682417a23f01");
        shoot.proveWithdrawalTransaction(
            Types.WithdrawalTransaction({
                nonce: uint256(1766847064778384329583297500742918515827483896875618958121606201292813757),
                sender: 0x4200000000000000000000000000000000000007,
                target: 0xD506952e78eeCd5d4424B1990a0c99B1568E7c2C,
                value: 	uint256(1170000000000),
                gasLimit: uint256(287624),
                data: bytes(hex"d764ad0b000100000000000000000000000000000000000000000000000000000002f5bc0000000000000000000000004200000000000000000000000000000000000010000000000000000000000000677311fd2ccc511bbc0f581e8d9a07b033d5e84000000000000000000000000000000000000000000000000000000110696f3400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000a41635f5fd000000000000000000000000ce23acf76228582e8d3d8778254c877a4ba5e13b000000000000000000000000ce23acf76228582e8d3d8778254c877a4ba5e13b00000000000000000000000000000000000000000000000000000110696f34000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
            }),

            // _l2OutputIndex
            uint256(14542),

            Types.OutputRootProof({
                version: bytes32(hex"0000000000000000000000000000000000000000000000000000000000000000"),
                stateRoot: bytes32(hex"0914061e90ee1cdc67c26824fab9d2224545467c42c8942b4dd37418a7a19133"),
                messagePasserStorageRoot: bytes32(hex"b8e3aff58962e63b993c80d386a30357e7466fc102dfa6ad628c66704da6cbe7"),
                latestBlockhash: 	bytes32(hex"858ac3c55694bb6d31fe3143abb4d2f1782eaa57a67231314e8517e3c78aae06")
            }),

            proofs
        );
    }

    function testBBB() public {
        // failure: https://testnet.bscscan.com/tx/0xa5f9d2f9c5804391ee695e0b0c71df17e1dd4333691fb714924ff2470320dadf
        bytes[] memory proofs = new bytes[](8);
        proofs[0] = bytes(hex"f90211a0feb6c6afca5ea568e0b7183d7292c112e9d28a1c846d889636d5c8822463aa77a0df719a24d8049d04a47e0e07ba493110fed0665d897c0ffdb05a7ce474782026a01bec363c069dc337ce16b4ca5cffa11d20e305fd7dcf6d87547b151c31aabf0ca00583d5a451bfa01f5e51d992e129ee17e65adda9495bda77898187484625aa9ea0bd9fef27cd52c2721e519bcd40c63a818095374e505a3bbd88db29c6c4521982a009a31937313c5b2bc06da6fec4075110f19526a9dbde3629ebe36aa8cd8e0851a0555f89002a34f6570bab438e69c5d8b855f2664e31f5dd59b807d0956577cc81a07e6f59ec99405b7afa436bf62abd098a85b43861fd3a9da3214a5d46b2d12543a03e7e883b0406cb781e5bf2a71cafc02ebbcdb0684ac03439633faf339d1259e2a0fa154fcf0bedd25aacac74e9864e4b96742c3d06f58c170cd320ade69db16c88a07e34154a031da5e50a3886efcb15c6681deeb20832726f083f80b03678b56d33a0d24408a39fb57838fdfe85c68f7eac74daab709ec3c22dfd0a579c1dbd64861aa093c1837ab2907fc51de7e918b81b997d60a6c8a18e3538720ee0d0f369530c26a0fca1af24293865f21d18d5eb823e0ecc007306823864f11d59c1c5c370fb22c2a0de8c894b5067d637df401aa6b963a3fc52b774abbedf6688e25bbf9a29672b7ca021c85d42de67601599e605d9ed1257451d1ce403d2478496d0a99d60db643d5280");
        proofs[1] = bytes(hex"f90211a02288f14667ef872b449e0f0f5526c2ad3634dcdb7376616d18fd87f6af9293bfa027223b95acda1508dbc42caac8edfb422759eedd13628e4dff0c5bf79d275182a0352a96940c817156a6e33c6f6cb2010ac216296f6e912c335982ba75ffb11898a0c3b7339a174d0a5fd842d3bb946a2ba6d9c1088215d9c3f56449af4dabb59e1ca03b331c72db0a3e0b51167ecb4d0ee76126181e3a54718e7cdefbf89ae0ae0d7ea03f162cadc26daa12d91e9ba459c9e61008ef57314e9cb810f074a878f2b81910a00dc670d0489ec214e2a636274d1e8b2df9db343218503ae2bf7ed868d8ab553fa0bffdd8cf5fe58452a64254f44e28ecd886964898fbab68711749423478d9c94ea0ca722fcaddd052f5a8ddce25c0c4161cd9e5552a0697ceccba540b0520cfcb61a0ffc0036ebf8ed2d9603de8c22d36cdc3fb451dd92a23adefe5593a4d8a12299da0bff43610f0c3d44e73e741d58f34f4d8e25aa3f67e0796241210bf321c2f1117a0341dcdbf2722bd7eacc3af46b6a9d80bb775dace93808a6737a1e135b9b225f3a07b3c3ec4c199c11374ba2dd28227e8c1efdbd8cb065768eff27e3918647eaccfa0e5a903a66eedfe8ea6d28a0f93cc91fc5f00f612a54aeeff100dafe84182a815a0203b138ec5130556a58d06184fdc399cb726954d28fe9fc68131f23d211382f5a057e92c1aec0a5b4e723cbbb3928d1008c9a9b4a26206656fccf70c14136a77de80");
        proofs[2] = bytes(hex"f90211a0437a65e2661356d938aa5321927d85003770566f25f121ec0dba4ad4acae9a8ca04acf516468076bf35f8c10e6aa904612fe08fcfba5c7b76bd87a5fe38e212c4da08db4fa1d774e1653468078c4c6a26cc6236025d6ab88dd1c02dae7c8bc7b19f7a03fb292d186e2d63e163788b3af313403cd12bc4b839037be4ad15a6fbbee217aa0dc569eab6a0b0a1d1dd7d12a24512bff7d4a6f5dc55a5a2dea31ed1a5415d383a0e4eaab256b73b4abc3402f44b6fa90a0854b733cdd5b884915ae8c07f5c78002a075ccef6818cc6c2870a70a0b41e3904ba2355937e028b02cb54a7ab321492357a0b059014d41d68c6c28b7de8f06b57c015210167d64c8589f9d7801dd4f025a60a07bf03f4912eaba2dd295222c1e01c1ddd7baedad61cf90d4e5987fc7ae1c6beaa0309d5aff3d1194cf259389cbb365e43548291aa9125d0550ab4908d1cc958844a0ff3fa5bba3bd95b08506336101c1c71cb920dd3ee68d8120654dac8f4b05d390a03a7b3de7b7476d9bf665396b718a28f8d746828bbf51a396e43669a4c90ca770a0913bc7b7ef04689a19cebf2c785f4eea68ccf9c97be94bb5bdd1346d4b145147a0cc21ab258bc2d961534438ddbbf185de30f8387acbc40f89857d88a23f90047ea0cf8b6876bd0cfd19ddd39fcfe88470d76757f64ba8496cfc382c92ed65706586a051de24dd2a27ffce89bb1dfcd6aa33469a91b50c4332ff9ef45d3cc917613a5c80");
        proofs[3] = bytes(hex"f90211a00aaeb3f8caea8f7167815fcdf1470777f7e100c781bc9ed79afefac295bb0d03a04b9f1d4ade00185fc62732b28abfb243afff140ebfa034daa4f139e0015a2195a0f9608d7d4346638e5ad4219ef6ea0769aa9fdb4bc6207831cf0f64854b072c2da0b953f4ee5f8ae17d9da8e3c1efaf9a822d0301dab05cae4b776fbd666fce8158a0bd8460bbbcfa3e02af0909445883176e3b65c85a63c6f91c2994fa2979228726a024f9c1c9952c2b6edec11955b50eaccd1ef44099db309f807f85aa4c4130b31ea056ad08d1e812df59fb54d2b847b1e7fa0872aaa1f3ac8f4e314d6893baece56aa02ca9f7cf8514dcca9401081f94b824f03b4d74dc690dfeed6779ddee4a9ad72ba050dffdadd79fbb8d857ad658864cd9cb19e69c73f8ba9c241fc2b451e2124320a00377a910bb501d1b22b7b03a3fa60aa47facf33515c10b0742fb76bd5a3d7a6ca0abcffd053ac378f2aa4d90e95c64dd7cc450fe6f961f9f55722cc49ef7b47f7ba042a8b3431675d5909bad710d519dd2c5d3287f3af8641122cce53b137087ce6ba0b77542431b232d0aabbbdf27e1c1adab761e144d396d0658ec1a84a712906a73a099ca74decdad4e079c0d1f35c8da403acbe65bf284253dab1be788f1808687eba06d866839d5ce08a75b3c8a2383b7eec6120ab32c7dfbe9b036831fc3101c8250a0fd315d671bf51da89b2db014d0f199be522fbf8e19d0276d0a14a1c66c1df8ac80");
        proofs[4] = bytes(hex"f901f1a0d6228395f59dea0ead05458d95d54c315c7feddf6416bb41aed62dc165446a6ca051e1ecb5424d948d386c0d291bb674fac4c47349f67e40a77850f54254b612b5a0e3b1d858fc2bb8001052eb3a36c9e2bea2966c795848aff0e5fb3cd779cfb565a0046a3c69a3639aa8bc1b3cf2c052d54424a88d2ea90a6388595b160ef5ef161780a0b2b1a778cbd8a3257ff7114116d892491a3ab148be723e22262b842680a9b29ea026da2284e756fcade15d922c0b8f6282a008e1c842e5030a307b3ea2e9a55726a026c0862e8e9e06ddef9ce37044fe2228a3ba9863faaf0cf1ad0863d41f7d7f13a0bcfbf48375296ad05ade4710ffe7e2b419fe246623369f7a6a4fa6f720bb185fa0d982dbbef7671cf7add6efd8612d47477b77f40d62e11983fe4478e959c0a86da0b3bf440462efb53c7056f5ff3ea134a072363a95a15a6945b83e416e6adee245a00396e89cb82998271f55ef0e892d456a7bbf624c23bf751f1ea2da6a7690be42a06f2588a03a07740fe4d300795096252abeb6b984e41b4f7027df84c1c520ea84a0ce163ce486c3de11ca2f6656f5dcf82e62496cb0d5472e042dede34d0e1aedd8a0fec8a8bfbf3e3418c4730c3c7c047cd73695c4c429f6ec6babc7165b9b27e635a002711d0ce2951376bac13daf1d3bcf359a90f68bc804b6b2b2e9efe09a8157af80");
        proofs[5] = bytes(hex"f89180808080808080a0326fe6fc4a847e4db1144153b15d0d3811f0317239f2885cc2a383825ccb1d8480a04455f6e0d1f8a2022ea33d5e6a537e384483dfccd19d07d21047e9b264b56e3c808080a06174ffa3ff6accab10abb5d61000db050324c608b10c0344a3eec6fa0107a079a0d494a04c23ba556fc3bdbe234562fe6825d55f3aaaa81e43415b8070a733d0bd8080");
        proofs[6] = bytes(hex"e482000fa03cb626e2849a157c57ca2e62c3dd139cf803efe281f5b6331b3ba92280dd8c42");
        proofs[7] = bytes(hex"f84d8080808080de9c332c35a4d03ec6ab9b3ffd06c69652ce8e02ff95537f98b7a0feb29c01808080de9c36620d27102d4799d259fe08f690c0a21b80d0a1a903db682417a23f0180808080808080");

        shoot.proveWithdrawalTransaction(
            Types.WithdrawalTransaction({
                nonce: uint256(1766847064778384329583297500742918515827483896875618958121606201292813757),
                sender: 0x4200000000000000000000000000000000000007,
                target: 0xD506952e78eeCd5d4424B1990a0c99B1568E7c2C,
                value: 	uint256(1170000000000),
                gasLimit: uint256(287624),
                data: bytes(hex"d764ad0b000100000000000000000000000000000000000000000000000000000002f5bc0000000000000000000000004200000000000000000000000000000000000010000000000000000000000000677311fd2ccc511bbc0f581e8d9a07b033d5e84000000000000000000000000000000000000000000000000000000110696f3400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000a41635f5fd000000000000000000000000ce23acf76228582e8d3d8778254c877a4ba5e13b000000000000000000000000ce23acf76228582e8d3d8778254c877a4ba5e13b00000000000000000000000000000000000000000000000000000110696f34000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000")
            }),

            // _l2OutputIndex
            uint256(74643),

            Types.OutputRootProof({
                version: bytes32(hex"0000000000000000000000000000000000000000000000000000000000000000"),
                stateRoot: bytes32(hex"34325ad3d0d6092b5796060d3072780ee5c828648334d9294397438f92e5902f"),
                messagePasserStorageRoot: bytes32(hex"00483c4fe5298b89a85a912d6d6899428e51e344785cea8d5d3aaa39295e1e17"),
                latestBlockhash: 	bytes32(hex"4fe10359c5b3fc6ac2ede872b01da2334f6032acce9c8c7da992c95a33937998")
            }),

            proofs
        );
    }
}

